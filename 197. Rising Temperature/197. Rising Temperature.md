LeetCode 197: Rising Temperature
================================

==============================

Problem Description
----------------

* * * * *

Write an SQL query to find all dates' `id` with higher temperature compared to its previous dates (yesterday).

Return the result table in any order.

* * * * *

Table Schema
----------------

### `Weather`

| Column Name | Type | Description |
| --- | --- | --- |
| `id` | int | The primary key of the table. |
| `recordDate` | date | The date of the weather record. |
| `temperature` | int | The temperature on that date. |

* * * * *

Example Input
----------------

### `Weather` Table:

| id | recordDate | temperature |
| --- | --- | --- |
| 1 | 2015-01-01 | 10 |
| 2 | 2015-01-02 | 25 |
| 3 | 2015-01-03 | 20 |
| 4 | 2015-01-04 | 30 |

* * * * *

Expected Output
----------------

| id |
| --- |
| 2 |
| 4 |

Explanation:

-   On 2015-01-02, temperature was 25° which is higher than the previous day (10°)

-   On 2015-01-04, temperature was 30° which is higher than the previous day (20°)

* * * * *

SQL Solution
----------------

```sql

WITH cte AS (
  SELECT
    id,
    recordDate,
    temperature,
    LAG(temperature) OVER (ORDER BY recordDate) AS prev_temp,
    LAG(recordDate) OVER (ORDER BY recordDate) AS prev_date
  FROM Weather
)
SELECT id AS id
FROM cte
WHERE temperature > prev_temp
  AND DATEDIFF(day, prev_date, recordDate) = 1;
```
* * * * *

Query Explanation
----------------


### Step 1: Common Table Expression (CTE) with Window Functions

```sql

WITH cte AS (
  SELECT
    id,
    recordDate,
    temperature,
    LAG(temperature) OVER (ORDER BY recordDate) AS prev_temp,
    LAG(recordDate) OVER (ORDER BY recordDate) AS prev_date
  FROM Weather
)
```


-   LAG(temperature) OVER (ORDER BY recordDate): This window function gets the temperature from the previous row when ordered by date. For each record, it retrieves the temperature from the day before.

-   LAG(recordDate) OVER (ORDER BY recordDate): Similarly, this gets the date from the previous row.

-   The CTE creates a temporary result set where each row contains:

    -   Current date's data (id, recordDate, temperature)

    -   Previous day's temperature (`prev_temp`)

    -   Previous day's date (`prev_date`)

### Step 2: Filtering for Rising Temperatures on Consecutive Days

```sql

SELECT id AS id
FROM cte
WHERE temperature > prev_temp
  AND DATEDIFF(day, prev_date, recordDate) = 1;
```
-   temperature > prev_temp: Filters for days where the current temperature is higher than the previous day's temperature.

-   DATEDIFF(day, prev_date, recordDate) = 1: This is crucial - it ensures we're only comparing consecutive days. The `DATEDIFF` function calculates the difference in days between the previous date and current date. A difference of 1 means they are consecutive days.

Why this condition is important: Without checking for consecutive days, we might incorrectly compare temperatures from non-consecutive days (like skipping weekends or missing data days).

### Alternative Solution (Using Self-Join):

```sql

SELECT w1.id
FROM Weather w1
JOIN Weather w2 ON DATEDIFF(day, w2.recordDate, w1.recordDate) = 1
WHERE w1.temperature > w2.temperature;
```
Key Insight: Both solutions solve the problem by comparing each day with its immediate predecessor, but the window function approach (using LAG) is often more efficient and readable for this type of sequential comparison.