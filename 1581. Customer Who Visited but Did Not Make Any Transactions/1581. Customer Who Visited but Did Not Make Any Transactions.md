LeetCode 1581: Customer Who Visited but Did Not Make Any Transactions
=====================================================================

==============================

Problem Description
-----------------
* * * * *

Write a SQL query to find the IDs of customers who visited a shopping mall without making any transactions, and the number of times they made such visits.

Return the result table sorted in any order.

* * * * *

Table Schema
-----------------
### `Visits`

| Column Name | Type | Description |
| --- | --- | --- |
| `visit_id` | int | The primary key of the table. |
| `customer_id` | int | The ID of the customer who visited the mall. |

### `Transactions`

| Column Name | Type | Description |
| --- | --- | --- |
| `transaction_id` | int | The primary key of the table. |
| `visit_id` | int | The ID of the visit associated with this transaction (foreign key to Visits table). |
| `amount` | int | The amount of the transaction. |

* * * * *

Example Input
-----------------
### `Visits` Table:

| visit_id | customer_id |
| --- | --- |
| 1 | 23 |
| 2 | 9 |
| 4 | 30 |
| 5 | 54 |
| 6 | 96 |
| 7 | 54 |
| 8 | 54 |

### `Transactions` Table:

| transaction_id | visit_id | amount |
| --- | --- | --- |
| 2 | 5 | 310 |
| 3 | 5 | 300 |
| 9 | 5 | 200 |
| 12 | 1 | 910 |
| 13 | 2 | 970 |

* * * * *

Expected Output
-----------------
| customer_id | count_no_trans |
| --- | --- |
| 54 | 2 |
| 30 | 1 |
| 96 | 1 |

* * * * *

SQL Solution
-----------------

```
SELECT customer_id,
       COUNT(*) as count_no_trans
FROM Visits
LEFT JOIN Transactions ON Visits.visit_id = Transactions.visit_id
WHERE Transactions.visit_id IS NULL
GROUP BY customer_id;
```
* * * * *

Query Explanation
-----------------

1.  LEFT JOIN: We start with the `Visits` table and perform a LEFT JOIN with the `Transactions` table using the `visit_id` column. This ensures that:

    -   All visits are included in the result set

    -   Visits that have corresponding transactions will have transaction data attached

    -   Visits without transactions will have NULL values for all transaction columns

2.  WHERE Clause: `Transactions.visit_id IS NULL` - This is the key filter that identifies visits without transactions. When a LEFT JOIN finds no matching transaction record, all columns from the Transactions table will be NULL. Checking if `Transactions.visit_id` IS NULL effectively filters for visits that have no associated transactions.

3.  GROUP BY: We group the results by `customer_id` to count how many transaction-less visits each customer made.

4.  COUNT(*): This counts the number of visits without transactions for each customer. The count includes all rows that survived the WHERE filter (visits without transactions).

Step-by-step logic:

-   First, the LEFT JOIN creates a combined table of all visits with their transaction data (if any)

-   Then, the WHERE filter removes all visits that had transactions, leaving only visits without transactions

-   Finally, we group by customer_id and count how many such visits each customer had